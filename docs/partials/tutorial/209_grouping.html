<h1><code ng:non-bindable=""></code>
<span class="hint"></span>
</h1>
<div><p>The grouping feature allows you to group rows together based on similar
values in specific columns, providing an effect similar in some ways to an Excel pivot table.</p>

<p>Grouping leverages the sort functionality, and has some impacts on sorting.  A column(s) that
is marked as being grouped is always the first column(s) in the sort list.  The actual sort order,
and therefore group order, is based on the sorting that has been set for that column, so it can
leverage custom sort functions and external sorting.</p>

<p>Any grouped column has 'suppressRemoveSort' set, when a column is ungrouped then <code>suppressRemoveSort</code>
is returned to the value in the columnDef.</p>

<p>Optionally (and by default) grouped columns are moved to the front of the grid, which provides a more
visually pleasing effect.  This isn't done with pinning, so as to not create a dependency on pinning, 
but by moving the columns themselves. </p>

<p>Aggregation is permitted on any column that isn't being grouped by, so you can obtain counts, sums,
max or min for any of the non-grouped columns.</p>

<p>Grouping and aggregation should work cleanly with filtering - it should group and aggregate only the 
filtered rows.</p>

<p>Grouping is still alpha, and under development, however it is included in the distribution files
to allow people to start using it.  Notable outstandings are:</p>

<ul>
<li>does not permit columns that are based on functions or complex objects.  The groupHeader rows create
a fake row.entity, and then set the appropriate fields in that entity.  This doesn't work well with 
complex column definitions at present</li>
<li>doesn't work well with edit yet.  Edit needs to notice that the row is of type internal, and not 
attempt to edit it</li>
<li>notify data change capability is needed for when people programmatically change the grouping  </li>
<li>some more unit testing</li>
<li>enhancement: allow a limit on number of columns grouped</li>
<li>consideration of RTL - not sure whether the indent/outdent should get reversed?</li>
</ul>

<p>Options to watch out for include:</p>

<ul>
<li><code>groupingIndent</code>: the expand buttons are indented by a number of pixels (default 10) as the grouping
level gets deeper.  Larger values look nicer, but mean that you probably need to make your groupHeader
wider if you're allowing deep grouping</li>
<li><code>groupingRowHeaderWidth</code>: the width of the grouping row header, important as above</li>
<li>'groupingSuppressAggregationText`: if your column has a cellFilter, the insertion of text (e.g. 'min: xxxx') 
usually breaks the cellFilter.  So you can suppress the aggregation text, but then you don't get a clear
visual indication of what sort of aggregation is going on.  Refer the example below, the balance column with
an average  </li>
</ul><h2 id="Example">Example</h2>
<div class="example"><p>In this example we group by the state column then the gender column, and we count the names (a proxy for 
counting the number of rows), we find the max age for each grouping, and we calculate the average balance.  We
suppress the aggregation text on the balance column because we want to format as currency...but that means that 
we can't easily see that it's an average.</p>

<h4>Source</h4>
<div source-edit="app" source-edit-deps="angular.js app.js" source-edit-html="index.html-60" source-edit-css="main.css" source-edit-js="app.js" source-edit-unit="" source-edit-scenario="scenario.js-61"></div>
<div class="tabbable"><div class="tab-pane" title="index.html">
<pre class="prettyprint linenums" ng-set-text="index.html-60" ng-html-wrap-loaded="app angular.js app.js"></pre>
<script type="text/ng-template" id="index.html-60">
    <div ng-controller="MainCtrl">
      <div id="grid1" ui-grid="gridOptions" ui-grid-grouping ui-grid-pinning class="grid"></div>
      <button id="expandAll" type="button" class="btn btn-success" ng-click="expandAll()">Expand All</button>
      <button id="toggleFirstRow" type="button" class="btn btn-success" ng-click="toggleRow(0)">Toggle First Row</button>
      <button id="toggleSecondRow" type="button" class="btn btn-success" ng-click="toggleRow(1)">Toggle Second Row</button>
    </div>
  </script>
</div>
<div class="tab-pane" title="main.css">
<pre class="prettyprint linenums" ng-set-text="main.css"></pre>
<style type="text/css" id="main.css">
    .grid {
      width: 500px;
      height: 400px;
    }
  </style>
</div>
<div class="tab-pane" title="app.js">
<pre class="prettyprint linenums" ng-set-text="app.js"></pre>
<script type="text/ng-template" id="app.js">
    var app = angular.module('app', ['ngAnimate', 'ngTouch', 'ui.grid', 'ui.grid.grouping', 'ui.grid.pinning' ]);

    app.controller('MainCtrl', ['$scope', '$http', '$interval', 'uiGridGroupingConstants', function ($scope, $http, $interval, uiGridGroupingConstants ) {
      $scope.gridOptions = {
        enableFiltering: true,
        columnDefs: [
          { name: 'state', grouping: { groupPriority: 1 }, sort: { direction: 'desc' }, width: '25%' },
          { name: 'gender', grouping: { groupPriority: 2 }, sort: { direction: 'asc' }, width: '20%' },
          { name: 'name', grouping: { aggregation: uiGridGroupingConstants.aggregation.COUNT }, width: '30%' },
          { name: 'age', grouping: { aggregation: uiGridGroupingConstants.aggregation.MAX }, width: '20%' },
          { name: 'company', width: '25%' },
          { name: 'balance', width: '25%', cellFilter: 'currency', groupingSuppressAggregationText: true, grouping: { aggregation: uiGridGroupingConstants.aggregation.AVG } }
        ],
        onRegisterApi: function( gridApi ) {
          $scope.gridApi = gridApi;
        }
      };

     $http.get('/data/500_complex.json')
     .success(function(data) {
       for ( var i = 0; i < data.length; i++ ){
         data[i].state = data[i].address.state;
         data[i].balance = Number( data[i].balance.slice(1).replace(/,/,'') );
       }
       $scope.gridOptions.data = data;
     });
 
      $scope.expandAll = function(){
        $scope.gridApi.grouping.expandAllRows();
      };
      
      $scope.toggleRow = function( rowNum ){
        $scope.gridApi.grouping.toggleRowGroupingState($scope.gridApi.grid.renderContainers.body.visibleRowCache[rowNum]);
      }
    }]);
  </script>
</div>
<div class="tab-pane" title="End to end test">
<pre class="prettyprint linenums" ng-set-text="scenario.js-61"></pre>
<script type="text/ng-template" id="scenario.js-61">
    var gridTestUtils = require('../../test/e2e/gridTestUtils.spec.js');
    describe( '209 grouping', function() {
    });
  </script>
</div>
</div><h4>Demo</h4>
<div class="well doc-example-live animator-container" ng-embed-app="app" ng-set-html="index.html-60" ng-eval-javascript="app.js"></div></div>
</div>
